---
id: hpc-aws-bedrock-setup
title: AWS Bedrock Setup
sidebar_label: Setup
sidebar_position: 1
---

import { Card, CardHeader, CardTitle, CardDescription } from '@site/src/components/Card';
import { Callout } from '@site/src/components/Callout';
import { Features, Feature } from '@site/src/components/Features';
import { CollapsibleCodeBlock, InlineCodeCard } from '@site/src/components/CodeBlock';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

# AWS Bedrock Setup

AWS Bedrock is a fully managed service that offers foundation models from leading AI companies through a single API. The HPC Neura Execution Engine seamlessly integrates with AWS Bedrock to provide access to state-of-the-art language models for your AI workflows.

<Callout type="info">
AWS Bedrock provides access to models from Anthropic, AI21 Labs, Cohere, Meta, Mistral, Stability AI, and DeepSeek through a unified interface.
</Callout>

## Prerequisites

Before setting up AWS Bedrock integration, ensure you have:

<Features>
  <Feature title="AWS Account" icon="/img/icons/security.svg">
    Active AWS account with billing enabled
  </Feature>
  <Feature title="IAM Permissions" icon="/img/icons/settings.svg">
    Appropriate permissions for Bedrock access
  </Feature>
  <Feature title="Model Access" icon="/img/icons/ai-workflow.svg">
    Requested access to desired models
  </Feature>
</Features>

## Step 1: AWS Account Setup

### Create IAM User for Bedrock Access

<Card>
  <CardHeader>
    <CardTitle>IAM User Configuration</CardTitle>
  </CardHeader>
  <div style={{ padding: '1rem' }}>
    <p>Create a dedicated IAM user for your HPC Execution Node with the following policy:</p>
    
    <CollapsibleCodeBlock
      title="Bedrock IAM Policy"
      description="Minimum required permissions for Bedrock access"
      language="json"
      defaultCollapsed={false}
    >
{`{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "bedrock:InvokeModel",
        "bedrock:InvokeModelWithResponseStream",
        "bedrock:ListFoundationModels",
        "bedrock:GetFoundationModel"
      ],
      "Resource": "*"
    },
    {
      "Effect": "Allow",
      "Action": [
        "bedrock:GetModelInferenceProfile",
        "bedrock:ListModelInferenceProfiles"
      ],
      "Resource": "arn:aws:bedrock:*:*:inference-profile/*"
    }
  ]
}`}
    </CollapsibleCodeBlock>
    
    <Callout type="tip">
      For production environments, restrict the Resource field to specific model ARNs for enhanced security.
    </Callout>
  </div>
</Card>

### Generate Access Keys

<Tabs>
  <TabItem value="console" label="AWS Console" default>
    <div style={{ marginTop: '1rem' }}>
      <ol>
        <li>Navigate to IAM Console → Users → Your Bedrock User</li>
        <li>Click on "Security credentials" tab</li>
        <li>Under "Access keys", click "Create access key"</li>
        <li>Select "Application running outside AWS"</li>
        <li>Save both the Access Key ID and Secret Access Key securely</li>
      </ol>
    </div>
  </TabItem>
  
  <TabItem value="cli" label="AWS CLI">
    <div style={{ marginTop: '1rem' }}>
      <CollapsibleCodeBlock
        title="Create Access Key via CLI"
        language="bash"
      >
{`# Create access key for the IAM user
aws iam create-access-key --user-name bedrock-hpc-user

# Output will contain:
# - AccessKeyId
# - SecretAccessKey
# Save these securely!`}
      </CollapsibleCodeBlock>
    </div>
  </TabItem>
</Tabs>

## Step 2: Request Model Access

<Card>
  <CardHeader>
    <CardTitle>Enable Foundation Models</CardTitle>
  </CardHeader>
  <div style={{ padding: '1rem' }}>
    <p>Before using any model, you must request access through the AWS Console:</p>
    
        <ol>
        <li>Navigate to <strong>Amazon Bedrock Console</strong></li>
        <li>Click on <strong>Model access</strong> in the left sidebar</li>
        <li>Click <strong>Edit</strong> or <strong>Manage model access</strong></li>
        <li>
            Select the models you want to use:
            <ul>
            <li>Anthropic Claude (Claude 3 Haiku, Sonnet, Opus)</li>
            <li>DeepSeek (R1)</li>
            <li>Meta Llama</li>
            <li>Mistral AI</li>
            <li>Others as needed</li>
            </ul>
        </li>
        <li>Submit your request and wait for approval (usually instant for most models)</li>
        </ol>
            
    <Callout type="warning">
      Some models may require additional review or have specific access requirements. Check the model's documentation for details.
    </Callout>
  </div>
</Card>

## Step 3: Environment Configuration

### Configure Environment Variables

Create or update your `.env` file in the HPC Execution Node backend:

<CollapsibleCodeBlock
  title=".env Configuration"
  description="Required environment variables for AWS Bedrock"
  language="bash"
  defaultCollapsed={false}
>
{`# AWS Bedrock Configuration
AWS_REGION=us-east-2                    # Choose your preferred region
AWS_ACCESS_KEY_ID=your_access_key_id    # From IAM user creation
AWS_SECRET_ACCESS_KEY=your_secret_key   # From IAM user creation

# Default Model Configuration
DEFAULT_MODEL_ID=anthropic.claude-3-haiku-20240307-v1:0  # Default model

# For DeepSeek or models requiring inference profiles:
# DEFAULT_MODEL_ID=arn:aws:bedrock:us-east-2:account-id:inference-profile/us.deepseek.r1-v1:0

# Application Settings
LOG_LEVEL=INFO
ALLOW_CUSTOM_CODE=true`}
</CollapsibleCodeBlock>

<Callout type="info">
Store your AWS credentials securely. Never commit them to version control. Consider using AWS Secrets Manager or environment-specific configuration for production.
</Callout>

### Region Selection

Choose the AWS region based on:

<Features>
  <Feature title="Model Availability" icon="/img/icons/network.svg">
    Not all models are available in all regions
  </Feature>
  <Feature title="Latency" icon="/img/icons/hpc.svg">
    Select region closest to your users
  </Feature>
  <Feature title="Compliance" icon="/img/icons/security.svg">
    Consider data residency requirements
  </Feature>
</Features>

#### Common Region Choices:

<table>
  <thead>
    <tr>
      <th>Region</th>
      <th>Region Code</th>
      <th>Model Coverage</th>
      <th>Best For</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>US East (N. Virginia)</td>
      <td><code>us-east-1</code></td>
      <td>Most models</td>
      <td>General use, widest selection</td>
    </tr>
    <tr>
      <td>US East (Ohio)</td>
      <td><code>us-east-2</code></td>
      <td>Most models</td>
      <td>Lower cost, good coverage</td>
    </tr>
    <tr>
      <td>US West (Oregon)</td>
      <td><code>us-west-2</code></td>
      <td>Most models</td>
      <td>West coast users</td>
    </tr>
    <tr>
      <td>Europe (Frankfurt)</td>
      <td><code>eu-central-1</code></td>
      <td>Limited models</td>
      <td>EU compliance</td>
    </tr>
  </tbody>
</table>

## Step 4: Verify Setup

### Test Connection

Use this script to verify your Bedrock setup:

<CollapsibleCodeBlock
  title="Test Bedrock Connection"
  description="Python script to verify AWS Bedrock access"
  language="python"
>
{`import boto3
import json
from botocore.exceptions import ClientError

# Initialize Bedrock client
session = boto3.Session(
    region_name='us-east-2',  # Your configured region
    aws_access_key_id='your_access_key',
    aws_secret_access_key='your_secret_key'
)

bedrock = session.client('bedrock')
bedrock_runtime = session.client('bedrock-runtime')

# List available models
try:
    response = bedrock.list_foundation_models()
    print("Available models:")
    for model in response['modelSummaries'][:5]:  # Show first 5
        print(f"- {model['modelId']}: {model['modelName']}")
        
    # Test model invocation
    test_prompt = "Hello, this is a test."
    request_body = json.dumps({
        "messages": [{"role": "user", "content": test_prompt}],
        "max_tokens": 50,
        "temperature": 0.5
    })
    
    response = bedrock_runtime.invoke_model(
        modelId='anthropic.claude-3-haiku-20240307-v1:0',
        body=request_body,
        contentType='application/json',
        accept='application/json'
    )
    
    result = json.loads(response['body'].read())
    print(f"\\nTest successful! Model response: {result}")
    
except ClientError as e:
    print(f"Error: {e}")
    print("Please check your credentials and permissions.")`}
</CollapsibleCodeBlock>

### Common Setup Issues

<Tabs>
  <TabItem value="credentials" label="Invalid Credentials" default>
    <div style={{ marginTop: '1rem' }}>
      <Callout type="error" title="Error: Unable to locate credentials">
        <p><strong>Cause:</strong> AWS credentials not properly configured</p>
        <p><strong>Solution:</strong></p>
        <ul>
          <li>Verify AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY are set</li>
          <li>Check for typos in credential values</li>
          <li>Ensure no extra spaces or quotes in .env file</li>
        </ul>
      </Callout>
    </div>
  </TabItem>
  
  <TabItem value="permissions" label="Access Denied">
    <div style={{ marginTop: '1rem' }}>
      <Callout type="error" title="Error: AccessDeniedException">
        <p><strong>Cause:</strong> IAM user lacks necessary permissions</p>
        <p><strong>Solution:</strong></p>
        <ul>
          <li>Verify IAM policy includes bedrock:InvokeModel permission</li>
          <li>Check if model access has been granted in Bedrock console</li>
          <li>Ensure policy is attached to the IAM user</li>
        </ul>
      </Callout>
    </div>
  </TabItem>
  
  <TabItem value="region" label="Region Issues">
    <div style={{ marginTop: '1rem' }}>
      <Callout type="error" title="Error: Model not available in region">
        <p><strong>Cause:</strong> Selected model not available in configured region</p>
        <p><strong>Solution:</strong></p>
        <ul>
          <li>Check model availability in your region</li>
          <li>Change AWS_REGION to a supported region</li>
          <li>Update DEFAULT_MODEL_ID to a model available in your region</li>
        </ul>
      </Callout>
    </div>
  </TabItem>
</Tabs>

## Step 5: Integration with HPC Nodes

Once setup is complete, the HPC Execution Engine will automatically use AWS Bedrock for:

- **LLM Text Generation**: Text-based AI responses
- **LLM Structured Output**: JSON-formatted responses
- **Streaming Responses**: Real-time AI generation

The integration is handled through the `BedrockService` class which automatically:
- Detects model type (Anthropic, DeepSeek, etc.)
- Applies appropriate formatting
- Handles streaming and non-streaming requests
- Manages error handling and retries

## Security Best Practices

<Callout type="success" title="Production Security Checklist">
✅ Use IAM roles instead of access keys when running on EC2
✅ Rotate access keys regularly
✅ Use AWS Secrets Manager for credential storage
✅ Enable CloudTrail logging for audit trails
✅ Implement least-privilege IAM policies
✅ Use VPC endpoints for private connectivity
✅ Enable encryption in transit and at rest
</Callout>

## Next Steps

<div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1rem', marginTop: '1.5rem' }}>
  <Card>
    <CardHeader>
      <CardTitle>Model Selection</CardTitle>
      <CardDescription>
        Choose the right model for your use case
      </CardDescription>
    </CardHeader>
    <div style={{ padding: '1rem', paddingTop: 0 }}>
      <a href="./model-selection" style={{ textDecoration: 'none' }}>
        Explore models →
      </a>
    </div>
  </Card>
  
  <Card>
    <CardHeader>
      <CardTitle>Configuration</CardTitle>
      <CardDescription>
        Advanced configuration options
      </CardDescription>
    </CardHeader>
    <div style={{ padding: '1rem', paddingTop: 0 }}>
      <a href="./configuration" style={{ textDecoration: 'none' }}>
        Configure Bedrock →
      </a>
    </div>
  </Card>
</div>